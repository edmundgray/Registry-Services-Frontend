<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        <link rel="stylesheet" href="../CSS/style.css">
        
        <script src="../JS/javascript.js"></script>
        
        <title>Registry Services</title>
    </head>
    <body>
<!----------------------------------------------------------------------------
        Sidebar
  ------------------------------------------------------------------------------>
        <div class="sidebar">
            <ul>
                <li>
                    <a class="logo">
                        <span class="icon">
                            <img src="../Images/genericLogo.png" alt="Sidebar Logo" style="width: 40px; height: 40px;">
                        </span>
                        <span class="text">Registry Services</span>
                    </a>
                </li>
                <li>
                    <a href="eInvoicingSpecificationRegistry.html">
                        <span class="icon"><i class="fa-solid fa-house"></i></span>
                        <span class="text">eInvoicing Specification Registry</span>
                    </a>
                </li>
                <li class="protected">
                    <a href="governingEntityList.html">
                        <span class="icon"><i class="fa-solid fa-building"></i></span>
                        <span class="text">Governing Entities</span>
                    </a>
                </li>
                <li class="protected">
                    <a href="mySpecifications.html">
                        <span class="icon"><i class="fa-solid fa-folder"></i></span>
                        <span class="text">My Specifications</span>
                    </a>
                </li>
                <li class="protected">
                    <a href="#">
                        <span class="icon"><i class="fa-solid fa-file-medical"></i></span>
                        <span class="text">Add New Specification</span>
                    </a>
                </li class="protected">
                <li class="child-element protected">
                    <a href="IdentifyingInformation.html">
                        <span class="icon"><i class="fa-solid fa-info"></i></span>
                        <span class="text">Identifying Information</span>
                    </a>
                </li>
                <li class="child-element">
                    <a href="coreInvoiceModel.html">
                        <span class="icon"><i class="fa-solid fa-car"></i></span>
                        <span class="text">Core Invoice Model</span>
                    </a>
                </li>
                <li class="child-element">
                    <a href="ExtensionComponentDataModel.html">
                        <span class="icon"><i class="fa-solid fa-trailer"></i></span>
                        <span class="text">Extension Component Data Model</span>
                    </a>
                </li>
                <li class="child-element protected">
                    <a href="additionalRequirements.html">
                        <span class="icon"><i class="fa-solid fa-circle-plus"></i></span>
                        <span class="text">Additional Requirements</span>
                    </a>
                </li>
                <li class="child-element protected">
                    <a href="specificationPreview.html">
                        <span class="icon"><i class="fa-solid fa-square-check"></i></span>
                        <span class="text">Specification Preview</span>
                    </a>
                </li>
                <!-- Logging in/out-->
                <li id="loginLogoutItem">
                    <a href="#" onclick="toggleLogin()">
                        <span class="icon"><i class="fa-solid fa-right-from-bracket"></i></span>
                        <span class="text" id="loginLogoutButton">Logout</span>
                    </a>
                </li>
            </ul>
        </div>

<!----------------------------------------------------------------------------
        This is where the selected entry from the table in index.html will be displayed
------------------------------------------------------------------------------>
        <div class="page-Content">
            <h1><i class="fa-solid fa-house"></i> View Specification</h1>
            <br/>
            <div id="detailsTableContainer"></div>
<!----------------------------------------------------------------------------
        The 3 tabs for the specification details
  ------------------------------------------------------------------------------>
            <div class="tabs">
                <button class="tab-button active" onclick="showTab('identifyingInfo')">Identifying Information</button>
                <button class="tab-button" onclick="showTab('specificationModel')">Specification Model</button>
                <button class="tab-button" onclick="showTab('supportingArtefacts')">Supporting Artefacts</button>
            </div>

<!----------------------------------------------------------------------------
        The content for each tab
        1/3 General Information
  ------------------------------------------------------------------------------>
            <div id="identifyingInfo" class="tab-content active">
                <div class="info-section">
                    <!-- General Information -->
                    <div class="info-table">
                        <h3>General Information</h3>
                        <div class="info-row">
                            <label>Specification Name:</label>
                            <span id="specificationName"></span>
                        </div>
                        <div class="info-row">
                            <label>Governing Entity:</label>
                            <span id="governingEntity"></span>
                        </div>
                        <div class="info-row">
                            <label>Contact Information:</label>
                            <span id="contactInformation">N/A</span>
                        </div>
                        <div class="info-row">
                            <label>Sector:</label>
                            <span id="sector"></span>
                        </div>
                        <div class="info-row">
                            <label>Country:</label>
                            <span id="country"></span>
                        </div>
                        <div class="info-row">
                            <label>Purpose:</label>
                            <span id="purpose"></span>
                        </div>
                    </div>

<!----------------------------------------------------------------------------
        Technical Information
  ------------------------------------------------------------------------------>
                    <div class="info-table">
                        <h3>Technical Information</h3>
                        <div class="info-row">
                            <label>Specification Identifier:</label>
                            <span id="specificationIdentifier"></span>
                        </div>
                        <div class="info-row">
                            <label>Specification Version:</label>
                            <span id="specificationVersion"></span>
                        </div>
                        <div class="info-row">
                            <label>Date of Implementation:</label>
                            <span id="implementationDate"></span>
                        </div>
                        <div class="info-row">
                            <label>Core Version:</label>
                            <span id="coreVersion"></span>
                        </div>
                        <div class="info-row">
                            <label>Underlying Specification:</label>
                            <span id="underlyingSpecification"></span>
                        </div>
                        <div class="info-row">
                            <label>Specification Source Link:</label>
                            <span id="specificationSourceLink"></span>
                        </div>
                        <div class="info-row">
                            <label>Preferred Syntax:</label>
                            <span id="preferredSyntax"></span>
                        </div>
                    </div>
                </div>
            </div>

<!----------------------------------------------------------------------------
        2/3 Specification Model tab
  ------------------------------------------------------------------------------>
            <div id="specificationModel" class="tab-content">
                <div class="info-section">

<!----------------------------------------------------------------------------
        Selected Core Invoice Model elements
  ------------------------------------------------------------------------------>
                    <div class="info-table">
                        <h3>Selected Core Invoice Model elements</h3>
                        <table id="coreInvoiceModelTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Business Term</th>
                                    <th>Type of Change</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Rows are dynamically populated -->
                            </tbody>
                        </table>
                    </div>

<!----------------------------------------------------------------------------
        Selected Extension Component Data Model elements
  ------------------------------------------------------------------------------>
                    <div class="info-table">
                        <h3>Selected Extension Component Data Model elements</h3>
                        <table id="extensionComponentTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Business Term</th>
                                    <th>Extension Component</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Placeholder -->
                            </tbody>
                        </table>
                    </div>

<!----------------------------------------------------------------------------
        Additional Requirements
  ------------------------------------------------------------------------------>
                    <div class="info-table">
                        <h3>Additional Requirements</h3>
                        <table id="additionalRequirementsTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Business Term</th>
                                    <th>Type of Change</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Placeholder for future content -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

<!----------------------------------------------------------------------------
        3/3 Supporting Artefacts tab
  ------------------------------------------------------------------------------>
            <div id="supportingArtefacts" class="tab-content">
                <div class="info-section">
                    <div class="info-table">

<!----------------------------------------------------------------------------
        URL Links
  ------------------------------------------------------------------------------>
                        <h3>Links</h3>
                        <div class="info-row">
                            <label>Specification Source Link:</label>
                            <span>
                                <a href="https://www.eascdc.com/invoicing/specifications/agdas.v1" target="_blank">
                                    https://wwww.loremipsum.com
                                </a>
                            </span>
                        </div>
                        <div class="info-row">
                            <label>Codelist(s):</label>
                            <span>
                                <a href="https://www.eascdc.com/invoicing/specifications/agdas.v1/codelists" target="_blank">
                                    https://wwww.loremipsum.com
                                </a>
                            </span>
                        </div>
                        <div class="info-row">
                            <label>Validation Artefacts:</label>
                            <span>
                                <a href="https://www.eascdc.com/invoicing/specifications/agdas.v1/validation" target="_blank">
                                    https://wwww.loremipsum.com
                                </a>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

<!----------------------------------------------------------------------------
        Some exclusive JavaScript for this page
------------------------------------------------------------------------------>
        <script>
            document.addEventListener("DOMContentLoaded", function () 
            {
                const params = new URLSearchParams(window.location.search);
                const detailsTableContainer = document.getElementById("detailsTableContainer");

                // Creating a table element
                const table = document.createElement("table");
                table.id = "detailsTable";

                // Creating the header row
                const headerRow = table.insertRow();
                params.forEach((_, key) => 
                {
                    if (key !== "View" && key !== "IDs") 
                    { // This will exclude "View" and "IDs"
                        const th = document.createElement("th");
                        th.textContent = key;
                        headerRow.appendChild(th);
                    }
                });

                // Creating the data row
                const dataRow = table.insertRow();
                params.forEach((value, key) => 
                {
                    if (key !== "View" && key !== "IDs") 
                    { // Exclude "View" and "IDs"
                        const td = dataRow.insertCell();
                        td.textContent = value;
                    }
                });

                // Append the table to the container
                detailsTableContainer.appendChild(table);

                // Populate the Identifying Information section
                document.getElementById("specificationName").textContent = params.get("Name") || "N/A";
                document.getElementById("governingEntity").textContent = params.get("Governing Entity") || "N/A";
                document.getElementById("sector").textContent = params.get("Sector") || "N/A";
                document.getElementById("country").textContent = params.get("Country") || "N/A";
                document.getElementById("purpose").textContent = params.get("Purpose") || "N/A";

                // Populate Technical Information
                document.getElementById("specificationIdentifier").textContent = params.get("Specification Identifier") || "N/A";
                document.getElementById("specificationVersion").textContent = params.get("Specification Version") || "N/A";
                document.getElementById("implementationDate").textContent = params.get("Implementation Date") || "N/A";
                document.getElementById("coreVersion").textContent = params.get("Core Version") || "N/A";
                document.getElementById("underlyingSpecification").textContent = params.get("Underlying Specification") || "N/A";
                document.getElementById("specificationSourceLink").textContent = params.get("Specification Source Link") || "N/A";
                document.getElementById("preferredSyntax").textContent = params.get("Preferred Syntax") || "N/A";
            });

            // JavaScript to handle tab switching
            function showTab(tabId) {
                // Hide all tab content
                document.querySelectorAll('.tab-content').forEach(content =>
                {
                    content.classList.remove('active');
                });

                // Remove active class from all buttons
                document.querySelectorAll('.tab-button').forEach(button => 
                {
                    button.classList.remove('active');
                });

                // Show the selected tab content
                document.getElementById(tabId).classList.add('active');

                // Add active class to the clicked button
                event.target.classList.add('active');
            }

/******************************************************************************
        Load coreInvoiceModelElements.json and populate the table
 ******************************************************************************/
            document.addEventListener("DOMContentLoaded", function () 
            {
                const params = new URLSearchParams(window.location.search);
                let ids = [];
                try 
                {
                    const idsParam = params.get("IDs");
                    ids = idsParam ? (idsParam.startsWith("[") ? JSON.parse(idsParam) : idsParam.split(",")) : [];
                } 
                catch (error) 
                {
                    console.error("Error parsing IDs parameter:", error);
                }

                console.log("IDs from URL:", ids);

                fetch("../JSON/coreInvoiceModelElements.json")
                    .then(response => response.json())
                    .then(data => 
                    {
                        console.log("Fetched data:", data);
                        const coreInvoiceModelTableBody = document.querySelector("#coreInvoiceModelTable tbody");
                        
                        if (!coreInvoiceModelTableBody) 
                        {
                            console.error("Table body for coreInvoiceModelTable not found.");
                            return;
                        }

                        ids.forEach(id => 
                        {
                            const element = data.find(item => item.ID === id);
                            const row = document.createElement("tr");

                            const idCell = document.createElement("td");
                            idCell.textContent = id;
                            row.appendChild(idCell);

                            const businessTermCell = document.createElement("td");
                            businessTermCell.textContent = element ? element["Business Term"] : "N/A";
                            row.appendChild(businessTermCell);

                            const typeOfChangeCell = document.createElement("td");
                            typeOfChangeCell.textContent = element ? element["Type of Change"] : "N/A";
                            row.appendChild(typeOfChangeCell);

                            coreInvoiceModelTableBody.appendChild(row);
                        });

                        if (coreInvoiceModelTableBody.children.length === 0) 
                        {
                            const row = document.createElement("tr");
                            const cell = document.createElement("td");
                            cell.colSpan = 3;
                            cell.textContent = "No matching data found.";
                            row.appendChild(cell);
                            coreInvoiceModelTableBody.appendChild(row);
                        }
                    })
                    .catch(error => console.error("Error loading coreInvoiceModelElements.json:", error));
            });
        </script>
    </body>
</html>