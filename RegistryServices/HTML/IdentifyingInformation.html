<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        <link rel="stylesheet" href="../CSS/style.css">

        <script src="../JS/javascript.js"></script>

        <title>Registry Services</title>

        <style>
            .info-row input[type="text"],
            .info-row input[type="url"],
            .info-row input[type="date"],
            .info-row select {
                width: 100%;
                max-width: 240px;
                min-width: 90px;
                box-sizing: border-box;
                padding: 4.5px;
                font-size: 0.75rem;
            }
            .info-row label 
            {
                font-size: 0.741rem;
            }
            .info-table > div 
            {
                padding: 12.35px 9.5px 4.75px 9.5px !important;
                margin-bottom: 13.3px !important;
            }
            .info-table h3 
            {
                font-size: 0.8rem;
                margin-bottom: 7.5px;
            }
            .info-row 
            {
                margin-bottom: 7.6px;
            }
            .view-button 
            {
                padding: 4.75px 12.35px !important;
                font-size: 0.741rem !important;
            }
            .page-Content 
            {
                padding: 9.5px 1.52vw 1.52vw 1.52vw !important;
            }
            #contactInfo 
            {
                max-width: 240px;
                width: 100%;
                box-sizing: border-box;
                font-size: 0.75rem;
                padding: 4.5px;
            }
            #purpose 
            {
                max-width: 240px;
                width: 100%;
                box-sizing: border-box;
                font-size: 0.75rem;
                padding: 4.5px;
            }
            @media (max-width: 600px) 
            {
                .info-table 
                {
                    max-width: 100% !important;
                    padding: 0 2px;
                }
                .info-row input,
                .info-row select 
                {
                    max-width: 100%;
                    min-width: 0;
                    font-size: 0.76rem;
                }
                .page-Content 
                {
                    padding: 0 0.76vw;
                }
            }
        </style>
    </head>
    <body>
<!----------------------------------------------------------------------------
        Sidebar
  ------------------------------------------------------------------------------>
        <div class="sidebar">
            <ul>
                <li>
                    <a class="logo">
                        <span class="icon">
                            <img src="../Images/genericLogo.png" alt="Sidebar Logo" style="width: 40px; height: 40px;">
                        </span>
                        <span class="text">Registry Services</span>
                    </a>
                </li>
                <li>
                    <a href="eInvoicingSpecificationRegistry.html">
                        <span class="icon"><i class="fa-solid fa-house"></i></span>
                        <span class="text">eInvoicing Specification Registry</span>
                    </a>
                </li>
                <li class="protected">
                    <a href="governingEntityList.html">
                        <span class="icon"><i class="fa-solid fa-building"></i></span>
                        <span class="text">Governing Entities</span>
                    </a>
                </li>
                <li class="protected">
                    <a href="mySpecifications.html">
                        <span class="icon"><i class="fa-solid fa-folder"></i></span>
                        <span class="text">My Specifications</span>
                    </a>
                </li>
                <li class="protected">
                    <a href="#">
                        <span class="icon"><i class="fa-solid fa-file-medical"></i></span>
                        <span class="text">Add New Specification</span>
                    </a>
                </li class="protected">
                <li class="child-element protected">
                    <a href="IdentifyingInformation.html">
                        <span class="icon"><i class="fa-solid fa-info"></i></span>
                        <span class="text">Identifying Information</span>
                    </a>
                </li>
                <li class="child-element">
                    <a href="coreInvoiceModel.html">
                        <span class="icon"><i class="fa-solid fa-car"></i></span>
                        <span class="text">Core Invoice Model</span>
                    </a>
                </li>
                <li class="child-element">
                    <a href="ExtensionComponentDataModel.html">
                        <span class="icon"><i class="fa-solid fa-trailer"></i></span>
                        <span class="text">Extension Component Data Model</span>
                    </a>
                </li>
                <li class="child-element protected">
                    <a href="additionalRequirements.html">
                        <span class="icon"><i class="fa-solid fa-circle-plus"></i></span>
                        <span class="text">Additional Requirements</span>
                    </a>
                </li>
                <li class="child-element protected">
                    <a href="specificationPreview.html">
                        <span class="icon"><i class="fa-solid fa-square-check"></i></span>
                        <span class="text">Specification Preview</span>
                    </a>
                </li>
                <li id="loginLogoutItem">
                    <a href="#" onclick="toggleLogin()">
                        <span class="icon"><i class="fa-solid fa-right-from-bracket"></i></span>
                        <span class="text" id="loginLogoutButton">Logout</span>
                    </a>
                </li>
            </ul>
        </div>

<!----------------------------------------------------------------------------
        Main Content
  ------------------------------------------------------------------------------>
        <div class="page-Content">
            <h1><i class="fa-solid fa-info"></i> Identifying Information</h1>

            <p style="margin: 10px 0 20px 0;">
                Use the inputs below to begin the process of adding Identifying Information and supporting artefacts to your Specification.<br>
                <span style="color: #d9534f;">*Minimum information required</span>
            </p>

<!----------------------------------------------------------------------------
        (1/2) The Form
        General Information
  ------------------------------------------------------------------------------>            
            <form id="identifyingForm" class="info-table" style="max-width: 600px; margin-left: 0;">
                <div style="background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #0001; padding: 24px 24px 10px 24px; margin-bottom: 30px;">
                    <h3>General Information</h3>

                    <!-- Specification Name (Required) -->
                    <div class="info-row">
                        <label for="specName">*Specification name:
                            <span class="semantic-tooltip" title="Enter the official name of the specification.">?</span>
                        </label>
                        <input type="text" id="specName" name="specName" required>
                    </div>

                    <!-- Governing Entity (Required) -->
                    <div class="info-row">
                        <label for="governingEntity">Governing Entity:
                            <span class="semantic-tooltip" title="Organization or authority responsible for the specification.">?</span>
                        </label>
                        <input type="text" id="governingEntity" name="governingEntity">
                    </div>

                    <!-- Contact Info (Required) -->
                    <div class="info-row">
                        <label for="contactInfo">*Contact Information:
                            <span class="semantic-tooltip" title="Provide an email or phone number for contact.">?</span>
                        </label>
                        <textarea id="contactInfo" name="contactInfo" rows="2" required></textarea>
                    </div>

                   <!-- Sector (Required) --> 
                    <div class="info-row">
                        <label for="sector">*Sector:
                            <span class="semantic-tooltip" title="Select the sector from the NACE list.">?</span>
                        </label>
                        <select id="sector" name="sector" required>
                            <option value="">Select Sector</option>
                            <option>Agriculture, Forestry & Fishing</option>
                            <option>Mining & Quarrying</option>
                            <option>Manufacturing</option>
                            <option>Electricity & Gas</option>
                            <option>Water Supply & Waste Management</option>
                            <option>Construction</option>
                            <option>Wholesale & Retail Trade</option>
                            <option>Transportation & Storage</option>
                            <option>Accommodation & Food Services</option>
                            <option>Information & Communication</option>
                            <option>Financial & Insurance Activities</option>
                            <option>Real Estate Activities</option>
                            <option>Professional & Technical Activities</option>
                            <option>Administrative & Support Services</option>
                            <option>Public Administration & Defense</option>
                            <option>Education</option>
                            <option>Human Health & Social Work Activities</option>
                            <option>Arts, Entertainment & Recreation</option>
                            <option>Other Service Activities</option>
                            <option>Activities of Households as Employers</option>
                        </select>
                    </div>

                    <!-- Sub Sector (Not Required) -->
                    <div class="info-row">
                        <label for="subSector">Sub Sector:
                            <span class="semantic-tooltip" title="Specify a more detailed sector if applicable.">?</span>
                        </label>
                        <input type="text" id="subSector" name="subSector">
                    </div>

                    <!-- Country (Required) -->
                    <div class="info-row">
                        <label for="country">*Country:
                            <span class="semantic-tooltip" title="Select the country using the official EC country codes.">?</span>
                        </label>
                        <select id="country" name="country" required>
                            <option value="">Select Country</option>
                            <option value="DE">Germany (DE)</option>
                            <option value="NL">Netherlands (NL)</option>
                            <option value="BE">Belgium (BE)</option>
                            <option value="IE">Ireland (IE)</option>
                            <option value="FR">France (FR)</option>
                            <option value="SE">Sweden (SE)</option>
                            <option value="FI">Finland (FI)</option>
                            <option value="UK">United Kingdom (UK)</option>
                            <option value="US">United States (US)</option>
                            <option value="AU">Australia (AU)</option>
                            <option value="IN">India (IN)</option>
                            <option value="CA">Canada (CA)</option>
                        </select>
                    </div>

                    <!-- Purpose (Required) -->
                    <div class="info-row">
                        <label for="purpose">*Purpose:
                            <span class="semantic-tooltip" title="Describe the main purpose of the specification.">?</span>
                        </label>
                        <textarea id="purpose" name="purpose" rows="3" required></textarea>
                    </div>
                </div>
<!----------------------------------------------------------------------------
        (2/2) The Form
        Technical Information
  ------------------------------------------------------------------------------>   
                <div style="background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #0001; padding: 24px 24px 10px 24px;">
                    <h3 style="margin-top:0;">Technical Information</h3>

                    <!-- Specification Identifier (Required) -->
                    <div class="info-row">
                        <label for="specId">*Specification Identifier:
                            <span class="semantic-tooltip" title="A unique identifier for this specification (e.g., internal code or reference).">?</span>
                        </label>
                        <input type="text" id="specId" name="specId" required>
                    </div>

                    <!-- Specification Version (Not Required) -->
                    <div class="info-row">
                        <label for="specVersion">Specification Version:
                            <span class="semantic-tooltip" title="Version number or label for this specification.">?</span>
                        </label>
                        <input type="text" id="specVersion" name="specVersion">
                    </div>

                    <!-- Date of Implementation (Not Required) -->
                    <div class="info-row">
                        <label for="implDate">Date of Implementation:
                            <span class="semantic-tooltip" title="Date when this specification is planned to be or was implemented.">?</span>
                        </label>
                        <input type="date" id="implDate" name="implDate">
                    </div>

                    <!-- Core Version (Not Required) -->
                    <div class="info-row">
                        <label for="coreVersion">Core Version:
                            <span class="semantic-tooltip" title="Select the version of the core invoice model this specification is based on.">?</span>
                        </label>
                        <select id="coreVersion" name="coreVersion">
                            <option value="">Select Version</option>
                            <option>1.0</option>
                            <option>2.0</option>
                            <option>3.0</option>
                        </select>
                    </div>

                    <!-- Underlying Specification (Not Required) -->
                    <div class="info-row">
                        <label for="underlyingSpec">Underlying Specification:
                            <span class="semantic-tooltip" title="Reference to any underlying or base specification this builds on.">?</span>
                        </label>
                        <input type="text" id="underlyingSpec" name="underlyingSpec">
                    </div>

                    <!-- Specification Source Link (Not Required) -->
                    <div class="info-row">
                        <label for="sourceLink">Specification Source Link:
                            <span class="semantic-tooltip" title="A URL to the official source or documentation for this specification.">?</span>
                        </label>
                        <input type="url" id="sourceLink" name="sourceLink">
                    </div>

                    <!-- Preferred Syntax (Not Required) -->
                    <div class="info-row">
                        <label for="preferredSyntax">Preferred Syntax:
                            <span class="semantic-tooltip" title="Select the preferred syntax for this specification (e.g., UBL, EDIFACT, JSON).">?</span>
                        </label>

                        <select id="preferredSyntax" name="preferredSyntax">
                            <option value="">Select Syntax</option>
                            <option>UBL</option>
                            <option>EDIFACT</option>
                            <option>JSON</option>
                        </select>
                    </div>
                </div>

                <!-- Save, Cancel & Core Invoice Model Buttons -->
                <div style="display: flex; justify-content: space-between; gap: 10px; margin-top: 30px;">
                    <div>
                        <button type="button" onclick="handleSave()" class="view-button" style="background:#ccc; color:#333;">Save</button>
                       
                        <button type="button" onclick="handleCancel()" class="view-button" style="background-color: #F4A261; color: #fff;">Cancel Specification</button>
                    </div>

                    <div>
                        <button type="button" onclick="window.location.href='coreInvoiceModel.html'" class="view-button" style="background:#217a36;">Core Invoice Model</button>
                    </div>
                </div>
            </form>
        </div>

<!----------------------------------------------------------------------------
        JavaScript for mockup functionality
  ------------------------------------------------------------------------------>
        <script>
            let isFormDirty = false;

            function handleSave() 
            {
                const form = document.getElementById('identifyingForm');
                if (!form.reportValidity()) return;

                const data = 
                {
                    "id": form.specName.value,
                    "specName": form.specName.value,
                    "governingEntity": form.governingEntity.value,
                    "contactInfo": form.contactInfo.value,
                    "sector": form.sector.value,
                    "subSector": form.subSector.value,
                    "country": form.country.value,
                    "purpose": form.purpose.value,
                    "specId": form.specId.value,
                    "specVersion": form.specVersion.value,
                    "implDate": form.implDate.value,
                    "coreVersion": form.coreVersion.value,
                    "underlyingSpec": form.underlyingSpec.value,
                    "sourceLink": form.sourceLink.value,
                    "preferredSyntax": form.preferredSyntax.value,
                    "conformanceLevel": "N/A",
                    "registryStatus": "In Progress" // Always "In Progress"
                };

                
            


            let specs = JSON.parse(localStorage.getItem("specifications") || "[]");

            const editingSpecId = localStorage.getItem("selectedSpecification");
            
            if (editingSpecId) {
                    // If we are editing, find the index of the old specification.
                    const specIndex = specs.findIndex(spec => spec.specName === editingSpecId);
                    if (specIndex > -1) {
                        // If found, replace it with the new data.
                        specs[specIndex] = data;
                        alert("Specification updated and saved as In Progress.");
                    } else {
                        // If not found (edge case), add as a new spec.
                        specs.push(data);
                        alert("Specification saved as In Progress.");
                    }
                    } else {
                        // If we are not editing, just add the new spec.
                        specs.push(data);
                        alert("Specification saved as In Progress.");
                    }
                
                    localStorage.setItem("specifications", JSON.stringify(specs));

                    // Clean up the editing flags from localStorage
                    localStorage.removeItem("selectedSpecification");
                    localStorage.removeItem("editSpecData");
                    
                    isFormDirty = false;
                }

            
            function saveAndGoToCoreModel() 
            {
                const form = document.getElementById('identifyingForm');
                if (!form.reportValidity()) {
                    alert("Please fill out all required fields before proceeding.");
                    return;
                }

                const newSpecification = 
                {
                    "id": form.specName.value,
                    "Specification name": form.specName.value,
                    "Governing Entity": form.governingEntity.value,
                    "Contact Information": form.contactInfo.value,
                    "Sector": form.sector.value,
                    "Sub Sector": form.subSector.value,
                    "Country": form.country.value,
                    "Purpose": form.purpose.value,
                    "Specification Identifier": form.specId.value,
                    "Specification Version": form.specVersion.value,
                    "Date of Implementation": form.implDate.value,
                    "Core Version": form.coreVersion.value,
                    "Underlying Specification": form.underlyingSpec.value,
                    "Specification Source Link": form.sourceLink.value,
                    "Preferred Syntax": form.preferredSyntax.value,
                    "Registry Status": "In Progress",
                    "Type": "CIUS",
                    "Conformance Level": "N/A",
                };
                let specifications = JSON.parse(localStorage.getItem("mySpecification")) || [];
                specifications.push(newSpecification);
                localStorage.setItem('mySpecifications', JSON.stringify(specifications));
                isFormDirty = false; // Reset the dirty flag

                alert("Information saved successfully! You can now proceed to the Core Invoice Model.");
                window.location.href = 'coreInvoiceModel.html'; // Redirect to the Core Invoice Model page

            }

             function handleCancel() {
        // Display a confirmation dialog to the user.
        const userConfirmed = confirm("Warning! This Specification will be deleted, do you want to proceed?");

        // Proceed only if the user clicks "OK".
        if (userConfirmed) {

            

            // Check if we are in "Edit" mode by seeing if a specification was selected.
            const editingSpecId = localStorage.getItem("selectedSpecification");

            if (editingSpecId) {
                // If editing, find and remove the specification from the stored array.
                let specifications = JSON.parse(localStorage.getItem("specifications") || "[]");

                // Create a new array excluding the specification being deleted.
                const updatedSpecifications = specifications.filter(spec => spec.Name !== editingSpecId);

                // Save the updated array back to localStorage.
                localStorage.setItem('specifications', JSON.stringify(updatedSpecifications));

                // Clean up the edit flag.
                localStorage.removeItem("selectedSpecification");
            }
            // Note: If not in "Edit" mode (i.e., creating a new spec that hasn't been saved),
            // there is nothing to delete from localStorage, so we can just redirect.

            // Redirect the user back to their specifications page.
            window.location.href = 'mySpecifications.html';
        }
        // If the user clicks "Cancel" on the confirmation, do nothing.
    }


            document.addEventListener('DOMContentLoaded', () => 
            {
                const form = document.getElementById('identifyingForm');
                

                const editingSpecId = localStorage.getItem("selectedSpecification");
                const specDataString = localStorage.getItem("editSpecData");

                if (editingSpecId) {
                    const titleElement = document.querySelector('.page-Content h1');
                    if (titleElement) {
                        titleElement.innerHTML += ` for: ${editingSpecId}`;
                    }
                }

                if (editingSpecId && specDataString) {
                    const params = new URLSearchParams(specDataString);

                    // Populate form fields with data from localStorage
                    form.specName.value = params.get('Name') || '';
                    form.governingEntity.value = params.get('Governing Entity') || '';
                    form.contactInfo.value = params.get('Contact Information') || 'N/A';
                    form.sector.value = params.get('Sector') || '';
                    form.subSector.value = params.get('Sub Sector') || '';
                    form.country.value = params.get('Country') || '';
                    form.purpose.value = params.get('Purpose') || '';
                    form.specId.value = params.get('Specification Identifier') || '';
                    form.specVersion.value = params.get('Specification Version') || '';
                    form.implDate.value = params.get('Implementation Date') || '';
                    form.coreVersion.value = params.get('Core Version') || '';
                    form.underlyingSpec.value = params.get('Underlying Specification') || '';
                    form.sourceLink.value = params.get('Specification Source Link') || '';
                    form.preferredSyntax.value = params.get('Preferred Syntax') || '';
                }

                const elements = form.querySelectorAll('input, textarea, select');
                elements.forEach(element => 
                {
                    element.addEventListener('change', () => 
                    {
                        isFormDirty = true;
                    });
                });
            });

            window.addEventListener('beforeunload', function (e) 
            {
                if (isFormDirty) 
                {
                    e.preventDefault();
                    // This is required because most browsers need it to trigger the confirmation dialog
                    e.returnValue = '';
                }
            });

        </script>
    </body>
</html>